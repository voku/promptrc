chrome.runtime.onInstalled.addListener(async()=>{console.log(".promptrc extension installed"),(await chrome.storage.sync.get(["customPatterns"])).customPatterns||await chrome.storage.sync.set({customPatterns:[]})});chrome.commands.onCommand.addListener(e=>{e==="insert_prompt"&&chrome.tabs.query({active:!0,currentWindow:!0},o=>{var r;(r=o[0])!=null&&r.id&&chrome.tabs.sendMessage(o[0].id,{action:"showPromptPicker"})}),e==="toggle_extension"&&chrome.storage.sync.get(["extensionEnabled"],o=>{const t=!(o.extensionEnabled!==!1);chrome.storage.sync.set({extensionEnabled:t},()=>{chrome.tabs.query({},s=>{s.forEach(c=>{c.id&&chrome.tabs.sendMessage(c.id,{action:"toggleExtension",enabled:t})})}),chrome.action.setBadgeText({text:t?"":"OFF"}),chrome.action.setBadgeBackgroundColor({color:"#ef4444"})})})});chrome.runtime.onMessage.addListener((e,o,r)=>{if(e.action==="getPatterns")return chrome.storage.sync.get(["customPatterns"],t=>{r({customPatterns:t.customPatterns||[]})}),!0;if(e.action==="saveCustomPattern")return chrome.storage.sync.get(["customPatterns"],t=>{if(chrome.runtime.lastError){console.error("Storage error:",chrome.runtime.lastError),r({success:!1,error:chrome.runtime.lastError.message});return}const s=t.customPatterns||[];s.push(e.pattern),chrome.storage.sync.set({customPatterns:s},()=>{chrome.runtime.lastError?(console.error("Storage error:",chrome.runtime.lastError),r({success:!1,error:chrome.runtime.lastError.message})):r({success:!0})})}),!0;if(e.action==="deleteCustomPattern")return chrome.storage.sync.get(["customPatterns"],t=>{if(chrome.runtime.lastError){console.error("Storage error:",chrome.runtime.lastError),r({success:!1,error:chrome.runtime.lastError.message});return}const c=(t.customPatterns||[]).filter(a=>a.id!==e.patternId);chrome.storage.sync.set({customPatterns:c},()=>{chrome.runtime.lastError?(console.error("Storage error:",chrome.runtime.lastError),r({success:!1,error:chrome.runtime.lastError.message})):r({success:!0})})}),!0});
