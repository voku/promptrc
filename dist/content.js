import{A as S}from"./assets/constants-DkOSrM93.js";const N=300;let i=null,r=null,m=!1,w="",c=0,p=null,b=!0,x=!1,f=new Map;const D=50;let v=[...S];async function M(){return new Promise(t=>{chrome.storage.sync.get(["customPatterns"],e=>{const o=e.customPatterns||[];v=[...S,...o],f.clear(),t(v)})})}chrome.storage.onChanged.addListener((t,e)=>{e==="sync"&&t.customPatterns&&M()});M();let E=null;function O(){E||(E=new MutationObserver(t=>{t.some(o=>o.type==="childList"&&o.removedNodes.length>0)&&r&&(document.body.contains(r)||(r=null,m=!1))}),E.observe(document.body,{childList:!0,subtree:!0}))}O();chrome.storage.sync.get(["disabledSites","extensionEnabled"],t=>{const e=t.disabledSites||[],o=window.location.hostname;x=e.includes(o),b=t.extensionEnabled!==!1});function $(){return["[data-slash-command]",'[data-autocomplete-type="slash-command"]',".slash-command",'[role="menu"][aria-label*="command"]'].some(e=>document.querySelector(e)!==null)}const R=$();function A(t){if(t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement)return t.selectionStart||0;const e=window.getSelection();if(!e||e.rangeCount===0)return 0;const o=e.getRangeAt(0),n=o.cloneRange();return n.selectNodeContents(t),n.setEnd(o.endContainer,o.endOffset),n.toString().length}function L(t,e){if(e===0)return!1;const o=Math.max(0,e-50),n=t.substring(o,e),a=n.lastIndexOf("/");if(a===-1)return!1;const s=n.substring(a+1);return!s.includes(" ")&&!s.includes(`
`)}let T=!1;document.addEventListener("compositionstart",()=>{T=!0,m&&u()});document.addEventListener("compositionend",()=>{T=!1});document.addEventListener("input",t=>{if(!b||x||T)return;const e=t.target;if(!P(e))return;if(i=e,t instanceof InputEvent&&t.data!=="/"){const H=h(e),k=A(e);L(H,k)||u();return}const o=h(e),n=A(e);if(!L(o,n)){u();return}const a=Math.max(0,n-50),s=o.substring(a,n),l=s.lastIndexOf("/"),d=s.substring(l+1);if(d.includes(" ")||d.includes(`
`)){u();return}p&&clearTimeout(p),p=window.setTimeout(()=>{w=d.toLowerCase(),m=!0,c=0,I(e,w)},R?N:100)},!0);document.addEventListener("keydown",t=>{if(!m||!r)return;const e=r.querySelectorAll(".promptrc-menu-item");if(e.length===0)return;const o=document.querySelector('[role="listbox"], [role="menu"], .autocomplete-dropdown');if(!(o&&o!==r))if(t.key==="ArrowDown")t.preventDefault(),t.stopPropagation(),c=Math.min(c+1,e.length-1),g(e);else if(t.key==="ArrowUp")t.preventDefault(),t.stopPropagation(),c=Math.max(c-1,0),g(e);else if(t.key==="Enter"&&m){const n=e[c];n&&(t.preventDefault(),t.stopPropagation(),n.click())}else t.key==="Escape"?(t.stopPropagation(),u()):t.key==="Tab"&&(t.preventDefault(),t.shiftKey?c=c===0?e.length-1:c-1:c=(c+1)%e.length,g(e))},!0);document.addEventListener("click",t=>{r&&!r.contains(t.target)&&u()});function P(t){if(t.isContentEditable||t.tagName==="TEXTAREA")return!0;if(t.tagName==="INPUT"){const e=t.type;return["text","search","email","url"].includes(e)}return!1}function h(t){return t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement?t.value:t.textContent||""}function C(t,e){t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement?(t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))):t.isContentEditable&&(t.textContent=e,t.dispatchEvent(new Event("input",{bubbles:!0})))}function I(t,e){const o=e.toLowerCase();let n;if(f.has(o))n=f.get(o);else{if(n=v.filter(l=>e?l.trigger.toLowerCase().includes(e)||l.purpose.toLowerCase().includes(e)||l.id.toLowerCase().includes(e):!0).slice(0,8),f.size>=D){const l=f.keys().next().value;f.delete(l)}f.set(o,n)}if(n.length===0){u();return}r||(r=Y()),z(n);const a=B(),s=Math.max(a+1,999999);r.style.zIndex=String(s),W(t,r),r.parentElement||document.body.appendChild(r),r.style.display="block",requestAnimationFrame(()=>{r&&(r.style.opacity="1",r.style.transform="translateY(0)")}),m=!0,Z(`${n.length} prompt patterns available`)}function Y(){const t=document.createElement("div");return t.className="promptrc-menu",t.setAttribute("role","listbox"),t.setAttribute("aria-label","Prompt pattern suggestions"),t.style.cssText=`
    position: fixed;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    z-index: 999999;
    max-height: 400px;
    overflow-y: auto;
    min-width: 400px;
    max-width: 500px;
    opacity: 0;
    transform: translateY(-8px);
    transition: opacity 0.15s ease, transform 0.15s ease;
    will-change: opacity, transform;
  `,t}function z(t){r&&(r.innerHTML="",c=0,t.forEach((e,o)=>{const n=document.createElement("div");n.className="promptrc-menu-item",n.setAttribute("role","option"),n.setAttribute("aria-selected",o===0?"true":"false"),n.setAttribute("id",`promptrc-option-${o}`),n.style.cssText=`
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #f3f4f6;
      transition: background-color 0.15s;
    `,n.innerHTML=`
      <div style="font-weight: 600; font-size: 13px; color: #111827; margin-bottom: 4px;">
        ${y(e.icon||"üìù")} ${y(e.id.replace(/^(ritual|pat)-/,""))}
      </div>
      <div style="font-size: 12px; color: #6b7280; line-height: 1.4;">
        ${y(e.trigger.substring(0,60))}${e.trigger.length>60?"...":""}
      </div>
    `,n.addEventListener("mouseenter",()=>{c=o,g(r.querySelectorAll(".promptrc-menu-item"))}),n.addEventListener("click",()=>{_(e)}),r.appendChild(n)}),r.setAttribute("aria-activedescendant","promptrc-option-0"),g(r.querySelectorAll(".promptrc-menu-item")))}function B(){return 999998}function W(t,e){const o=t.getBoundingClientRect(),n=400,a=400,s=5;let l=o.bottom+window.scrollY+s,d=o.left+window.scrollX;o.bottom+n+s>window.innerHeight&&(l=o.top+window.scrollY-n-s),o.left+a>window.innerWidth&&(d=window.innerWidth-a-s),d=Math.max(s,d),e.style.top=`${l}px`,e.style.left=`${d}px`}function Z(t){const e=document.createElement("div");e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.style.cssText="position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.remove()},1e3)}function u(){r&&r.parentElement&&(r.style.opacity="0",r.style.transform="translateY(-8px)",setTimeout(()=>{r&&r.parentElement&&(r.style.display="none")},150)),m=!1,w="",c=0,p&&(clearTimeout(p),p=null)}function g(t){t.forEach((e,o)=>{const n=e;n.setAttribute("aria-selected",o===c?"true":"false"),o===c?(n.style.backgroundColor="#f0fdf4",n.style.borderLeftColor="#10b981",n.style.borderLeftWidth="3px",n.style.borderLeftStyle="solid",r&&r.setAttribute("aria-activedescendant",n.id)):(n.style.backgroundColor="white",n.style.borderLeft="none")})}function _(t){if(!i)return;const e=h(i),o=e.lastIndexOf("/");if(o!==-1){const n=e.substring(0,o)+t.trigger;if(C(i,n),i instanceof HTMLTextAreaElement||i instanceof HTMLInputElement)i.focus(),i.setSelectionRange(n.length,n.length);else if(i.isContentEditable){i.focus();const a=document.createRange(),s=window.getSelection();a.selectNodeContents(i),a.collapse(!1),s==null||s.removeAllRanges(),s==null||s.addRange(a)}}u()}function y(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}chrome.runtime.onMessage.addListener((t,e,o)=>{try{if(t.action==="showPromptPicker")return i&&I(i,""),o({success:!0}),!0;if(t.action==="insertPrompt"){const n=t.pattern,a=document.activeElement;if(a&&P(a)){i=a;const s=h(i),l=s+(s?`
`:"")+n.trigger;C(i,l),i.focus()}else{const s=document.querySelectorAll('textarea, input[type="text"], [contenteditable="true"]');if(s.length>0){i=s[0];const l=h(i),d=l+(l?`
`:"")+n.trigger;C(i,d),i.focus()}}return o({success:!0}),!0}if(t.action==="toggleSite")return x=t.disabled,x&&u(),o({success:!0}),!0;if(t.action==="toggleExtension")return b=t.enabled,b||u(),o({success:!0}),!0}catch(n){console.error("Error handling message:",n),o({success:!1,error:String(n)})}return!0});window.addEventListener("beforeunload",()=>{u()});
