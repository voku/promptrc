(function(){"use strict";var o=(e=>(e.RITUAL="RITUAL",e.DEV_PATTERN="DEV_PATTERN",e.COMBINATION="COMBINATION",e))(o||{});const L=[{id:"ritual-rabbit",trigger:"Follow the white rabbit...",purpose:"Marks a mode shift into high-context or metaphoric thinking",implication:"Cognitive priming for complexity",type:o.RITUAL,icon:"üêá",examples:["Deep dive into the specific memory leak in this Node.js buffer processing stream. Follow the white rabbit until you reached the point of self-discovery as the V8 Garbage Collection engineer analyzing the heap snapshot."]},{id:"ritual-silent-room",trigger:"Rest in the silent room, so that...",purpose:"Enforces pause, clears noise before action",implication:"Simulates deep work state",type:o.RITUAL,icon:"üßò",examples:["I need to architect the disaster recovery plan for our multi-region Postgres cluster. Rest in the silent room, so that you can simulate the failure modes without the noise of 'standard best practices' and focus on our specific latency constraints."]},{id:"ritual-self-discovery",trigger:"Do it until you reach the point of self-discovery as...",purpose:"Signals reflective closure, not just output ending",implication:"Pattern mining becomes part of task conclusion",type:o.RITUAL,icon:"üï≥Ô∏è",examples:["Debug this race condition in the Go routine scheduler. Do it until you reach the point of self-discovery as the compiler realizing why the mutex lock is being bypassed."]},{id:"ritual-step-by-step",trigger:"Do it step by step and ask for confirmation after each...",purpose:"Makes iteration transparent and traceable",implication:"LLM reasons in deltas, not blobs",type:o.RITUAL,icon:"üë£",examples:["Refactor this monolithic `utils.ts` file into a domain-driven folder structure. Do it step by step and ask for confirmation after each domain group is isolated to ensure we don't break circular dependencies."]},{id:"ritual-brutal-honesty",trigger:"Be brutally honest / Blind Spot Analysis for...",purpose:"Forces critique over compliance",implication:"Model becomes adversarial partner, not affirmation loop",type:o.RITUAL,icon:"üõ°Ô∏è",examples:["Review my code for this authentication middleware. Be brutally honest / Blind Spot Analysis for security vulnerabilities, specifically focusing on timing attacks and session fixation."]},{id:"ritual-dod",trigger:"Continue until you reached the definition of done from your custom instructions.",purpose:"Enforces strict adherence to pre-defined completion criteria",implication:"Prevents partial outputs and ensures all constraints are met.",type:o.RITUAL,icon:"üèÅ",examples:["Generate the Terraform module for this ECS cluster. Continue until you reached the definition of done from your custom instructions (including IAM least-privilege policies, CloudWatch log groups, and tagging standards)."]}],D=[{id:"pat-persona-adopt",trigger:"You are a [Role] designed to [Function]...",purpose:"Sets behavioral boundaries/expertise",implication:"Persona Adoption",type:o.DEV_PATTERN,icon:"üÜî",examples:["You are a Senior SRE designed to optimize Kubernetes clusters for high-throughput financial trading."]},{id:"pat-context-prime",trigger:"Context: [Tech Stack], [Constraints], [Current State]...",purpose:"Narrows the search space to relevant domains",implication:"Context Priming",type:o.DEV_PATTERN,icon:"üìç",examples:["Context: [Next.js 14 App Router], [Vercel Edge Functions], [Pre-migration from Pages Router]. How do I handle middleware?"]},{id:"pat-perspective-take",trigger:"Act as a [Specific Specialist] (e.g., Security Auditor).",purpose:`Shifts the model's "lens" to a specific sub-discipline`,implication:"Perspective Taking",type:o.DEV_PATTERN,icon:"üëì",examples:["Review this SQL schema. Act as a GDPR Compliance Officer looking for PII leakage."]},{id:"pat-anchor",trigger:"Anchor: These facts are immutable for this conversation: [Facts].",purpose:"Establishes ground truth that cannot be hallucinated away",implication:"Fact Pinning",type:o.DEV_PATTERN,icon:"‚öì",examples:["Plan the migration. Anchor: These facts are immutable: [No downtime allowed], [Must use AWS RDS], [Budget cap $500/mo]."]},{id:"pat-fmt-enforce",trigger:"Format output as: [JSON/File Tree/Markdown].",purpose:"Ensures machine-readable or visually distinct output",implication:"Schema Enforcement",type:o.DEV_PATTERN,icon:"üìë",examples:["Analyze the dependency tree. Format output as: [JSON adjacency list].","Extract the email addresses. Format output as: [Valid JSON list only], no conversational filler."]},{id:"pat-silence",trigger:"Silence mode: No disclaimers, no apologies, no meta-commentary.",purpose:"Removes LLM verbal tics and noise",implication:"Signal-to-Noise Optimization",type:o.DEV_PATTERN,icon:"üîï",examples:["Convert this CSV to SQL INSERT statements. Silence mode: No disclaimers, no apologies, no meta-commentary. Just code."]},{id:"pat-diff-smart",trigger:"Show changes only / Show before & after.",purpose:"Reduces token usage and cognitive load",implication:"Output Constraining",type:o.DEV_PATTERN,icon:"‚úÇÔ∏è",examples:["Update the config to enable CORS. Show only the changed lines.","Refactor the class. Show before & after diffs for the changed methods."]},{id:"rule-length",trigger:"Cap length: [X] sentences. Stop immediately after.",purpose:"Hard limit on output volume",implication:"Models love rambling. Enforce limits.",type:o.DEV_PATTERN,icon:"üìè",examples:["Summarize the error log. Cap length: 2 sentences. Stop immediately after."]},{id:"rule-tone",trigger:"Tone: Clinical, objective, no hype.",purpose:"Prohibit optimism and marketing fluff",implication:"Explicitly block hype and optimism.",type:o.DEV_PATTERN,icon:"üòê",examples:["Write a launch post for our new API. Tone: Clinical, objective, no hype. Focus on latency metrics only."]},{id:"pat-debug-cot",trigger:"Think step-by-step: 1. Interpret error 2. List causes...",purpose:"Forces logical deduction over rapid guessing (Debugging)",implication:"Chain of Thought (CoT)",type:o.DEV_PATTERN,icon:"üß†",examples:["I'm getting a 'Hydration failed' error in React. Think step-by-step: 1. Interpret error 2. List causes 3. Propose fixes."]},{id:"pat-chain-logic",trigger:"Chain of thought: First X, then Y, finally Z.",purpose:"Explicit reasoning steps for complex logic (General)",implication:"Showing work improves accuracy.",type:o.DEV_PATTERN,icon:"üîó",examples:["Debug why this SQL query is slow. Chain of thought: First analyze the EXPLAIN ANALYZE output, then check index usage, finally suggest composite indices."]},{id:"pat-step-back",trigger:"Step Back: What are key decision factors for [Architecture]?",purpose:"Activates broad knowledge before narrowing down",implication:"Step-Back Prompting",type:o.DEV_PATTERN,icon:"üîô",examples:["Step Back: What are key decision factors for [Choosing a Message Queue] for a startup?"]},{id:"pat-ensemble",trigger:"Self-Consistency: Run this 3 times and pick the best.",purpose:"Mitigates hallucination variance",implication:"Ensemble Averaging",type:o.DEV_PATTERN,icon:"üîÅ",examples:["Generate 3 clever names for this startup. Self-Consistency: Run this 3 times and pick the best."]},{id:"pat-unname",trigger:"Unname this: what is it without the buzzword?",purpose:"Strips bias-inducing labels (Abstraction)",implication:"Naming narrows thinking.",type:o.DEV_PATTERN,icon:"üè∑Ô∏è",examples:["Explain 'Inversion of Control'. Unname this: what is it without the buzzword? Explain it using a metaphor of a restaurant kitchen."]},{id:"pat-confidence",trigger:"Confidence Score: Rate certainty (0-100%) for each claim.",purpose:"Forces epistemic honesty and probabilistic output",implication:"Uncertainty Handling",type:o.DEV_PATTERN,icon:"‚ùî",examples:["Propose 3 root causes for this 504 Gateway Timeout. Confidence Score: Rate certainty (0-100%) for each claim."]},{id:"pat-anti-hallucination",trigger:'If unsure, state "Unknown". Do not invent/guess.',purpose:"Anti-hallucination guard",implication:"Honesty Enforcement",type:o.DEV_PATTERN,icon:"üö´",examples:["Explain the usage of the experimental API `React.useEvent`. If unsure, state 'Unknown'. Do not invent syntax that doesn't exist yet."]},{id:"pat-audit-domain",trigger:"Analyze this for [Performance/Security/Accessibility] issues.",purpose:"Proactive auditing against specific non-functional requirements",implication:"Static Analysis Simulation",type:o.DEV_PATTERN,icon:"üî¨",examples:["Analyze this component for [Re-render Performance] issues specifically in the list mapping.","Review this form. Analyze this for [WCAG 2.1 Accessibility] issues regarding keyboard navigation."]},{id:"pat-stress-test",trigger:"Stress Test: What breaks this solution? / Edge Cases.",purpose:"Proactive failure analysis and risk assessment",implication:"Adversarial Thinking",type:o.DEV_PATTERN,icon:"üß™",examples:["Here is my proposed caching strategy. Stress Test: What breaks this solution? Consider race conditions and cache stampedes.","What are the edge cases for [a recurring calendar event parser]?"]},{id:"pat-compliance",trigger:"Compliance: Does output meet [Standard]?",purpose:"Enforces external requirements (Standards, Style Guides)",implication:"Standards Adherence",type:o.DEV_PATTERN,icon:"üìã",examples:["Generate the API schema. Compliance: Does output meet [OpenAPI 3.1 Spec] strictly?"]},{id:"pat-checkpoint",trigger:"Checkpoint: Summarize state before proceeding.",purpose:"Prevents context drift in long conversation chains",implication:"State Persistence",type:o.DEV_PATTERN,icon:"üíæ",examples:["We have defined the schema. Checkpoint: Summarize state before proceeding to the resolver implementation."]},{id:"pat-meta-track",trigger:"Track: What worked/failed in this session?",purpose:"Post-mortem analysis for meta-learning",implication:"Learning Loop",type:o.DEV_PATTERN,icon:"üìà",examples:["We finally fixed the bug. Track: What worked/failed in this session? Summarize the dead-ends we took so I don't repeat them."]},{id:"pat-compress",trigger:"Compress: Reduce verbosity while preserving [Key Info].",purpose:"Reclaims token budget without losing context",implication:"Lossy Compression",type:o.DEV_PATTERN,icon:"üßπ",examples:["This error log is too long. Compress: Reduce verbosity while preserving [Timestamps and Error Codes]."]},{id:"pat-reset",trigger:"Hard Reset: Forget previous context, start fresh.",purpose:"Escapes poisoned context or hallucination loops",implication:"Context Purge",type:o.DEV_PATTERN,icon:"üî•",examples:["You are stuck in a loop. Hard Reset: Forget previous context, start fresh. Let's tackle the problem from first principles."]},{id:"pat-constraint-box",trigger:"Constraints: [No X], [Only Y], [Style Z].",purpose:"Constraint boxing to limit solution space (inclusive & exclusive)",implication:"Creativity thrives in a box.",type:o.DEV_PATTERN,icon:"üì¶",examples:["Write a function to deep merge two objects. Constraints: [No external libraries like Lodash], [TypeScript strict mode], [Recursive approach].","Build a date picker. Constraints: [No Moment.js], [Native Date only]."]},{id:"pat-transform-metric",trigger:"Rewrite [Code] to improve [Metric: Speed/Readability].",purpose:"Optimizes against non-functional requirements",implication:"Constraint-Based Transformation",type:o.DEV_PATTERN,icon:"‚ö°",examples:["Rewrite [this O(n^2) filter loop] to improve [Metric: Speed] using a Set or Map."]},{id:"pat-time-horizon",trigger:"Time Horizon: Is this solution viable in [1yr/5yr]?",purpose:"Future-proofs recommendations against depreciation",implication:"Temporal Analysis",type:o.DEV_PATTERN,icon:"‚è±Ô∏è",examples:["Recommend a frontend build tool. Time Horizon: Is this solution viable in [3 years]? Avoid deprecated or stagnant projects."]},{id:"pat-priority",trigger:"Rank by priority: [Impact] > [Effort].",purpose:"Priority ordering for decision making",implication:"Not all code debt is created equal.",type:o.DEV_PATTERN,icon:"üì∂",examples:["Here is a list of 10 technical debt items. Rank by priority: [User Impact] > [Dev Effort]. Return the top 3."]},{id:"pat-phase-exec",trigger:"Phase 1: Analyze. Phase 2: Plan. Phase 3: Execute.",purpose:"Phase-based execution to prevent rushing to code",implication:"Thinking before coding reduces refactoring.",type:o.DEV_PATTERN,icon:"üìÖ",examples:["I need to migrate this legacy jQuery app to React. Phase 1: Analyze the event listeners. Phase 2: Plan the component hierarchy. Phase 3: Execute the code for the main dashboard."]},{id:"pat-scope-triage",trigger:"Triage first: Summarize inputs, then act.",purpose:"Input triage to ensure understanding",implication:"Read before you write.",type:o.DEV_PATTERN,icon:"üè•",examples:["Here are three different error logs from production. Triage first: Summarize the common pattern in inputs, then propose a single root cause fix."]},{id:"pat-ask-before",trigger:"Ask clarifying questions before answering.",purpose:"Prevent misalignment (Gate)",implication:"Intent beats guesswork.",type:o.DEV_PATTERN,icon:"‚ùì",examples:["I want to migrate our REST API to GraphQL using Apollo Federation. Ask clarifying questions before answering regarding our current microservice boundaries and caching strategy."]},{id:"pat-few-shot",trigger:"Create [Component] following these exact patterns: [Example Code].",purpose:"Enforces local project consistency over general training data",implication:"Few-Shot / In-Context Learning",type:o.DEV_PATTERN,icon:"üß¨",examples:["Create a user-profile card. Create [Component] following these exact patterns: [Attached 'Button.tsx' showing our Tailwind utility class conventions]."]},{id:"pat-infill",trigger:"Complete this code: [Partial Snippet]...",purpose:"Offloads syntactic overhead to the AI",implication:"Suffix/In-fill Generation",type:o.DEV_PATTERN,icon:"üß©",examples:["Complete this code: `const debouncedSearch = useCallback(`..."]}],C=[...L,...D],M=300;let a=null,r=null,m=!1,x="",l=0,f=null,b=!0,E=!1,g=new Map;const V=50;let T=[...C];async function P(){return new Promise(e=>{chrome.storage.sync.get(["customPatterns"],t=>{const n=t.customPatterns||[];T=[...C,...n],g.clear(),e(T)})})}chrome.storage.onChanged.addListener((e,t)=>{t==="sync"&&e.customPatterns&&P()}),P();let v=null;function _(){v||(v=new MutationObserver(e=>{e.some(n=>n.type==="childList"&&n.removedNodes.length>0)&&r&&(document.body.contains(r)||(r=null,m=!1))}),v.observe(document.body,{childList:!0,subtree:!0}))}_(),chrome.storage.sync.get(["disabledSites","extensionEnabled"],e=>{const t=e.disabledSites||[],n=window.location.hostname;E=t.includes(n),b=e.extensionEnabled!==!1});function z(){return["[data-slash-command]",'[data-autocomplete-type="slash-command"]',".slash-command",'[role="menu"][aria-label*="command"]'].some(t=>document.querySelector(t)!==null)}const H=z();function R(e){if(e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement)return e.selectionStart||0;const t=window.getSelection();if(!t||t.rangeCount===0)return 0;const n=t.getRangeAt(0),i=n.cloneRange();return i.selectNodeContents(e),i.setEnd(n.endContainer,n.endOffset),i.toString().length}function k(e,t){if(t===0)return!1;const n=Math.max(0,t-50),i=e.substring(n,t),c=i.lastIndexOf("/");if(c===-1)return!1;const s=i.substring(c+1);return!s.includes(" ")&&!s.includes(`
`)}let A=!1;document.addEventListener("compositionstart",()=>{A=!0,m&&u()}),document.addEventListener("compositionend",()=>{A=!1}),document.addEventListener("input",e=>{if(!b||E||A)return;const t=e.target;if(!N(t))return;if(a=t,e instanceof InputEvent&&e.data!=="/"){const Y=h(t),j=R(t);k(Y,j)||u();return}const n=h(t),i=R(t);if(!k(n,i)){u();return}const c=Math.max(0,i-50),s=n.substring(c,i),p=s.lastIndexOf("/"),d=s.substring(p+1);if(d.includes(" ")||d.includes(`
`)){u();return}f&&clearTimeout(f),f=window.setTimeout(()=>{x=d.toLowerCase(),m=!0,l=0,I(t,x)},H?M:100)},!0),document.addEventListener("keydown",e=>{if(!m||!r)return;const t=r.querySelectorAll(".promptrc-menu-item");if(t.length===0)return;const n=document.querySelector('[role="listbox"], [role="menu"], .autocomplete-dropdown');if(!(n&&n!==r))if(e.key==="ArrowDown")e.preventDefault(),e.stopPropagation(),l=Math.min(l+1,t.length-1),y(t);else if(e.key==="ArrowUp")e.preventDefault(),e.stopPropagation(),l=Math.max(l-1,0),y(t);else if(e.key==="Enter"&&m){const i=t[l];i&&(e.preventDefault(),e.stopPropagation(),i.click())}else e.key==="Escape"?(e.stopPropagation(),u()):e.key==="Tab"&&(e.preventDefault(),e.shiftKey?l=l===0?t.length-1:l-1:l=(l+1)%t.length,y(t))},!0),document.addEventListener("click",e=>{r&&!r.contains(e.target)&&u()});function N(e){if(e.isContentEditable||e.tagName==="TEXTAREA")return!0;if(e.tagName==="INPUT"){const t=e.type;return["text","search","email","url"].includes(t)}return!1}function h(e){return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement?e.value:e.textContent||""}function w(e,t){e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement?(e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))):e.isContentEditable&&(e.textContent=t,e.dispatchEvent(new Event("input",{bubbles:!0})))}function I(e,t){const n=t.toLowerCase();let i;if(g.has(n))i=g.get(n);else{if(i=T.filter(p=>t?p.trigger.toLowerCase().includes(t)||p.purpose.toLowerCase().includes(t)||p.id.toLowerCase().includes(t):!0).slice(0,8),g.size>=V){const p=g.keys().next().value;g.delete(p)}g.set(n,i)}if(i.length===0){u();return}r||(r=O()),F(i);const c=U(),s=Math.max(c+1,999999);r.style.zIndex=String(s),W(e,r),r.parentElement||document.body.appendChild(r),r.style.display="block",requestAnimationFrame(()=>{r&&(r.style.opacity="1",r.style.transform="translateY(0)")}),m=!0,B(`${i.length} prompt patterns available`)}function O(){const e=document.createElement("div");return e.className="promptrc-menu",e.setAttribute("role","listbox"),e.setAttribute("aria-label","Prompt pattern suggestions"),e.style.cssText=`
    position: fixed;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    z-index: 999999;
    max-height: 400px;
    overflow-y: auto;
    min-width: 400px;
    max-width: 500px;
    opacity: 0;
    transform: translateY(-8px);
    transition: opacity 0.15s ease, transform 0.15s ease;
    will-change: opacity, transform;
  `,e}function F(e){r&&(r.innerHTML="",l=0,e.forEach((t,n)=>{const i=document.createElement("div");i.className="promptrc-menu-item",i.setAttribute("role","option"),i.setAttribute("aria-selected",n===0?"true":"false"),i.setAttribute("id",`promptrc-option-${n}`),i.style.cssText=`
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #f3f4f6;
      transition: background-color 0.15s;
    `,i.innerHTML=`
      <div style="font-weight: 600; font-size: 13px; color: #111827; margin-bottom: 4px;">
        ${S(t.icon||"üìù")} ${S(t.id.replace(/^(ritual|pat)-/,""))}
      </div>
      <div style="font-size: 12px; color: #6b7280; line-height: 1.4;">
        ${S(t.trigger.substring(0,60))}${t.trigger.length>60?"...":""}
      </div>
    `,i.addEventListener("mouseenter",()=>{l=n,y(r.querySelectorAll(".promptrc-menu-item"))}),i.addEventListener("click",()=>{G(t)}),r.appendChild(i)}),r.setAttribute("aria-activedescendant","promptrc-option-0"),y(r.querySelectorAll(".promptrc-menu-item")))}function U(){return 999998}function W(e,t){const n=e.getBoundingClientRect(),i=400,c=400,s=5;let p=n.bottom+window.scrollY+s,d=n.left+window.scrollX;n.bottom+i+s>window.innerHeight&&(p=n.top+window.scrollY-i-s),n.left+c>window.innerWidth&&(d=window.innerWidth-c-s),d=Math.max(s,d),t.style.top=`${p}px`,t.style.left=`${d}px`}function B(e){const t=document.createElement("div");t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.style.cssText="position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)}function u(){r&&r.parentElement&&(r.style.opacity="0",r.style.transform="translateY(-8px)",setTimeout(()=>{r&&r.parentElement&&(r.style.display="none")},150)),m=!1,x="",l=0,f&&(clearTimeout(f),f=null)}function y(e){e.forEach((t,n)=>{const i=t;i.setAttribute("aria-selected",n===l?"true":"false"),n===l?(i.style.backgroundColor="#f0fdf4",i.style.borderLeftColor="#10b981",i.style.borderLeftWidth="3px",i.style.borderLeftStyle="solid",r&&r.setAttribute("aria-activedescendant",i.id)):(i.style.backgroundColor="white",i.style.borderLeft="none")})}function G(e){if(!a)return;const t=h(a),n=t.lastIndexOf("/");if(n!==-1){const i=t.substring(0,n)+e.trigger;if(w(a,i),a instanceof HTMLTextAreaElement||a instanceof HTMLInputElement)a.focus(),a.setSelectionRange(i.length,i.length);else if(a.isContentEditable){a.focus();const c=document.createRange(),s=window.getSelection();c.selectNodeContents(a),c.collapse(!1),s==null||s.removeAllRanges(),s==null||s.addRange(c)}}u()}function S(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}chrome.runtime.onMessage.addListener((e,t,n)=>{try{if(e.action==="showPromptPicker")return a&&I(a,""),n({success:!0}),!0;if(e.action==="insertPrompt"){const i=e.pattern,c=document.activeElement;if(c&&N(c)){a=c;const s=h(a),p=s+(s?`
`:"")+i.trigger;w(a,p),a.focus()}else{const s=document.querySelectorAll('textarea, input[type="text"], [contenteditable="true"]');if(s.length>0){a=s[0];const p=h(a),d=p+(p?`
`:"")+i.trigger;w(a,d),a.focus()}}return n({success:!0}),!0}if(e.action==="toggleSite")return E=e.disabled,E&&u(),n({success:!0}),!0;if(e.action==="toggleExtension")return b=e.enabled,b||u(),n({success:!0}),!0}catch(i){console.error("Error handling message:",i),n({success:!1,error:String(i)})}return!0}),window.addEventListener("beforeunload",()=>{u()})})();
